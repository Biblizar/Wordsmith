{% extends 'base.html.twig' %}

{% block title %}Forum {% endblock %}

{% block main %}
<div class="wrapper"> 
    {{ include('forum/jumbotron.html.twig') }}
    {% for category in categories %}
    <div class="container container-forum">
        <div class="category-header">
            <h2>{{category.name}}</h2>
        </div>
        {% for subcategory in category.subCategories %}
        {% if subcategory.isPrivate == 0 %}
            <div class="container-subcategory">
                <div class="container description">
                    <h3>
                        <a href="{{path('forum_subcategory', {'id': subcategory.id })}}">{{subcategory.name}}</a>
                    </h3>
                    <p>{{subcategory.reminder}}</p>
                </div>
                <div class="container last-message">
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    {% for hasReadSubcat in subcategory.hasReadSubcategories %}
                        {% if hasReadSubcat.user.id is defined %}
                            {% if hasReadSubcat.user.id == app.user.id and hasReadSubcat.subcategory.id == subcategory.id %}
                                {% if hasReadSubcat.threadCount < subcategory.threads|length %} 
                                    <img src="{{ asset('image/new.png') }}" class="icon">
                                {% elseif hasReadSubcat.postCount < subcategory.posts|length %}
                                    <img src="{{ asset('image/new.png') }}" class="icon">
                                {% else %}
                                    <img src="{{ asset('image/nonew.png') }}" class="icon">
                                {% endif  %}
                            {% endif %} 
                        {% endif %} 
                    {% endfor %}
                {% else %}
                    <img src="{{ asset('image/nonew.png') }}" class="icon">
                {% endif %} 
                </div>
                <div class="container statistic">
                    <small>{{subcategory.threads|length}} Sujets</small>
                    <small>{{subcategory.posts|length}} Réponses</small>
                </div>
            </div>
        {% else %}
        {% if is_granted('ROLE_MODERATOR') %}
            <div class="container-subcategory">
                <div class="container description">
                    <h3>
                        <a href="{{path('forum_subcategory', {'id': subcategory.id })}}">{{subcategory.name}}</a>
                    </h3>
                    <p>{{subcategory.reminder}}</p>
                </div>
                <div class="container last-message">
                {% for hasReadSubcat in subcategory.hasReadSubcategories %}
                    {% if hasReadSubcat.user.id is defined and app.user.id is defined %}
                        {% if hasReadSubcat.user.id == app.user.id and hasReadSubcat.subcategory.id == subcategory.id %}
                            {% if hasReadSubcat.threadCount < subcategory.threads|length %} 
                                <img src="{{ asset('image/new.png') }}" class="icon">
                            {% elseif hasReadSubcat.postCount < subcategory.posts|length %}
                                <img src="{{ asset('image/new.png') }}" class="icon">
                            {% else %}
                                <img src="{{ asset('image/nonew.png') }}" class="icon">
                            {% endif  %}
                        {% endif %} 
                    {% endif %} 
                {% endfor %}
                </div>
                <div class="container statistic">
                    <small>{{subcategory.threads|length}} Sujets</small>
                    <small>{{subcategory.posts|length}} Réponses</small>
                </div>
            </div>
        {% endif %}
        {% endif %}
    {% endfor %}
    </div>
    {% endfor %}
</div>
{% endblock %}